## 多线程异步

[python 多进程/多线程/协程 同步异步](https://www.cnblogs.com/who-care/p/9951211.html)

这篇主要是对概念的理解：

1、异步和多线程区别：二者不是一个同等关系,异步是最终目的,**多线程只是我们实现异步的一种手段**。异步是当一个调用请求发送给被调用者,而调用者不用等待其结果的返回而可以做其它的事情。实现异步可以采用多线程技术或则交给另外的进程来处理。**多线程的好处，比较容易的实现了 异步切换的思想， 因为异步的程序很难写的**。**多线程本身程还是以同步完成，但是应该说比效率是比不上异步的。 而且多线很容易写， 相对效率也高。**

2、异步和同步的区别： 

 

在io等待的时候，同步不会切走

，浪费了时间。异步和同步是相对的，同步就是顺序执行，执行完一个再执行下一个，需要等待、协调运行。异步就是彼此独立,在等待某事件的过程中继续做自己的事，不需要等待这一事件完成后再工作。线程就是实现异步的一个方式。

**异步是让调用方法的主线程不需要同步等待另一线程的完成，从而可以让主线程干其它的事情。**

 

3、 多线程：多线程是程序设计的逻辑层概念，它是进程中并发运行的一段代码。**多线程可以实现线程间的切换执行。**多线程的优点很明显，线程中的处理程序依然是顺序执行，符合普通人的思维习惯，所以编程简单。但是多线程的缺点也同样明显**，线程的使用（滥用）会给系统带来上下文切换的额外负担。并且线程间的共享变量可能造成死锁的出现。**

 

4、python因为GIL 全局锁的原因，**所以同一时刻只能有一个线程在运行，遇到IO操作才会释放切换**。当我们需要编写并发爬虫等IO密集型的程序时，应该选用多线程或者协程；当我们需要科学计算，设计CPU密集型程序，应该选用多进程，更好的利用多个CPU。





## Python爬虫之异步IO

文章来源：企鹅号

要想写出高效率的爬虫，异步IO是你必须掌握的一种技巧。在了解异步IO之前，你需要了解什么是协程。什么是协程？我个人对Python协程的理解，协程是一个函数，调用该函数的时候你可以通过某种方法暂停它，然后通过某种方法让它继续执行。协程跟我们爬虫有什么关系？我们知道一般的爬虫流程，都是向服务器发起请求，然后等待对方返回相应的数据，最后对数据进行处理。在等待请求的过程中，我们的程序是啥都没干的，而且等待的时间对CPU来说是非常漫长的。如果可以在等待服务器返回数据的时候，程序去发起下一个请求，等到前一个请求返回数据后，再来进行处理，那么效果就会好很多，这种操作也就是异步IO。当代码需要执行一个耗时的IO操作时，它只发出IO指令，并不等待IO结果，然后就去执行其他代码了。一段时间后，当IO返回结果时，再通知CPU进行处理。看上去是不是跟协程一样呢？ 异步IO就是协程的一种具体运用。如何在爬虫中使用异步IO？在Python爬虫中，要想实现异步IO需要用到两个模块,asyncio和 aiohttp**。**前者用来创建与运行协程，后者用来处理http请求和响应。asyncio模块该模块的工作原理：创建协程创建事件环（event_loop）把协程放进事件环（其实是把协程包装成future或者task再放进event_loop，这些细节先不讲）启动事件环，事件环运行里面的协程，当协程需要等待（await）的时候，事件环执行下一个协程。当所有的协程都运行过以后，再次回到第一个协程，如果需要等待的部分完成了，就执行下面的代码，还没则执行下一个协程，不断重复，直到所有协程，全部执行完毕再退出event_loop。